<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PDF Focus Reader</title>
  <style>
    :root {
      --bg: #0f172a;
      --panel: #1e293b;
      --text: #e2e8f0;
      --accent: #38bdf8;
      --muted: #94a3b8;
      --band-width: min(900px, 88vw);
      --band-height: 220px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .toolbar {
      position: sticky;
      top: 0;
      z-index: 20;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      padding: 12px;
      background: #1a2436;
      border-bottom: 1px solid #334155;
    }

    .toolbar button,
    .toolbar .file-label {
      border: 1px solid #475569;
      background: #0b1220;
      color: var(--text);
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
    }

    .toolbar button:hover,
    .toolbar .file-label:hover {
      border-color: var(--accent);
      color: white;
    }

    .toolbar button.active {
      background: #0c4a6e;
      border-color: #38bdf8;
    }

    .toolbar .file-label input { display: none; }

    .status {
      margin-left: auto;
      color: var(--muted);
      font-size: 13px;
      min-height: 1em;
    }

    #reader {
      position: relative;
      flex: 1;
      overflow: auto;
      padding: 24px 12px 48px;
    }

    #pdfPages {
      width: fit-content;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .page-canvas {
      background: white;
      box-shadow: 0 4px 18px rgba(0, 0, 0, 0.45);
      max-width: 96vw;
      height: auto;
    }

    #focusOverlay {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 30;
      display: none;
    }

    #focusOverlay.active { display: block; }

    .focus-mask {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.45);
    }

    .focus-band {
      position: absolute;
      left: 50%;
      width: var(--band-width);
      height: var(--band-height);
      transform: translateX(-50%);
      border: 3px solid var(--accent);
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 0 0 200vmax rgba(0, 0, 0, 0.45), 0 0 0 2px #fff2;
      background: #0b1220;
    }

    .focus-content {
      transform-origin: top left;
      will-change: transform;
    }

    .focus-page {
      display: block;
      margin-bottom: 14px;
      box-shadow: 0 4px 18px rgba(0, 0, 0, 0.45);
    }

    .hint {
      padding: 10px 12px;
      color: var(--muted);
      font-size: 13px;
      border-top: 1px solid #334155;
      background: #111827;
    }
  </style>
</head>
<body>
  <div class="toolbar">
    <label class="file-label">Load PDF
      <input id="pdfInput" type="file" accept="application/pdf" />
    </label>
    <button id="toggleFocus">Toggle Focus Mode</button>
    <button id="bandUp">Focus Band Up</button>
    <button id="bandDown">Focus Band Down</button>
    <button class="zoom" data-zoom="1">Zoom 1.0x</button>
    <button class="zoom" data-zoom="1.5">Zoom 1.5x</button>
    <button class="zoom" data-zoom="2">Zoom 2.0x</button>
    <span class="status" id="status">Load a PDF to begin.</span>
  </div>

  <main id="reader">
    <section id="pdfPages"></section>
  </main>

  <div id="focusOverlay" aria-hidden="true">
    <div class="focus-mask"></div>
    <div class="focus-band" id="focusBand">
      <div class="focus-content" id="focusContent"></div>
    </div>
  </div>

  <div class="hint">Tip: Focus mode magnifies only the highlighted band. Scroll as normal while the overlay is enabled.</div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script>
    pdfjsLib.GlobalWorkerOptions.workerSrc =
      'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

    const reader = document.getElementById('reader');
    const pdfPages = document.getElementById('pdfPages');
    const pdfInput = document.getElementById('pdfInput');
    const statusEl = document.getElementById('status');
    const overlay = document.getElementById('focusOverlay');
    const focusBand = document.getElementById('focusBand');
    const focusContent = document.getElementById('focusContent');
    const toggleFocusBtn = document.getElementById('toggleFocus');

    let focusEnabled = false;
    let focusZoom = 1.5;
    const baseScale = 1.25;
    let bandTop = Math.max(90, Math.round((window.innerHeight - 220) / 2));

    function setStatus(msg) {
      statusEl.textContent = msg;
    }

    function clearPages() {
      pdfPages.innerHTML = '';
      focusContent.innerHTML = '';
    }

    async function renderPdf(file) {
      clearPages();
      setStatus('Loading PDF...');

      const bytes = await file.arrayBuffer();
      const loadingTask = pdfjsLib.getDocument({ data: bytes });
      const doc = await loadingTask.promise;

      for (let n = 1; n <= doc.numPages; n += 1) {
        const page = await doc.getPage(n);
        const viewport = page.getViewport({ scale: baseScale });

        const canvas = document.createElement('canvas');
        canvas.className = 'page-canvas';
        canvas.width = viewport.width;
        canvas.height = viewport.height;

        const pageContext = canvas.getContext('2d');
        if (!pageContext) throw new Error('Unable to create a 2D context for PDF page rendering.');

        await page.render({ canvasContext: pageContext, viewport }).promise;
        pdfPages.appendChild(canvas);

        const mirrorCanvas = document.createElement('canvas');
        mirrorCanvas.className = 'focus-page';
        mirrorCanvas.width = canvas.width;
        mirrorCanvas.height = canvas.height;

        const mirrorContext = mirrorCanvas.getContext('2d');
        if (!mirrorContext) throw new Error('Unable to create a 2D context for focus overlay rendering.');

        mirrorContext.drawImage(canvas, 0, 0);
        focusContent.appendChild(mirrorCanvas);
      }

      setStatus(`Loaded ${doc.numPages} page${doc.numPages === 1 ? '' : 's'}.`);
      syncFocusView();
    }

    function syncFocusView() {
      if (!focusEnabled) return;
      const readerRect = reader.getBoundingClientRect();
      const xOffset = readerRect.left + reader.clientLeft + (reader.scrollLeft || 0);
      const yOffset = readerRect.top + reader.clientTop + (reader.scrollTop || 0);

      focusContent.style.transform = `translate(${-xOffset * focusZoom}px, ${-(yOffset + bandTop) * focusZoom}px) scale(${focusZoom})`;
      focusBand.style.top = `${bandTop}px`;
    }

    function setFocusEnabled(enabled) {
      focusEnabled = enabled;
      overlay.classList.toggle('active', enabled);
      toggleFocusBtn.classList.toggle('active', enabled);
      toggleFocusBtn.textContent = enabled ? 'Disable Focus Mode' : 'Toggle Focus Mode';
      if (enabled) syncFocusView();
    }

    pdfInput.addEventListener('change', async (event) => {
      const file = event.target.files?.[0];
      if (!file) return;
      try {
        await renderPdf(file);
      } catch (err) {
        console.error(err);
        setStatus('Failed to load PDF. Check console for details.');
      }
    });

    toggleFocusBtn.addEventListener('click', () => setFocusEnabled(!focusEnabled));

    document.getElementById('bandUp').addEventListener('click', () => {
      bandTop = Math.max(0, bandTop - 40);
      syncFocusView();
    });

    document.getElementById('bandDown').addEventListener('click', () => {
      bandTop = Math.min(window.innerHeight - focusBand.clientHeight, bandTop + 40);
      syncFocusView();
    });

    document.querySelectorAll('.zoom').forEach((btn) => {
      btn.addEventListener('click', () => {
        focusZoom = Number(btn.dataset.zoom);
        document.querySelectorAll('.zoom').forEach((b) => b.classList.toggle('active', b === btn));
        syncFocusView();
      });
    });

    reader.addEventListener('scroll', syncFocusView, { passive: true });
    window.addEventListener('resize', () => {
      bandTop = Math.min(Math.max(0, bandTop), window.innerHeight - focusBand.clientHeight);
      syncFocusView();
    });

    document.querySelector('[data-zoom="1.5"]').classList.add('active');
    focusBand.style.top = `${bandTop}px`;
  </script>
</body>
</html>
